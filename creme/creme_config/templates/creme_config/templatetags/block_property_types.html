{% load cycle from future %}{% load i18n %}
{% load creme_core_tags creme_widgets creme_block %}
{% if not request.is_ajax %}
    <div class="help_box">{% trans 'Deleting a property type will delete the associated properties' %}</div>
{% endif %}
{% has_perm_to admin 'creme_core' as admin_perm %}
{% with colspan=6 %}
<table class="table_detail_view ui-corner-all with-header {{state.classes}}" id="{{block_name}}">
    {% get_block_header colspan=colspan %}
        <th class="label">{% get_block_title _('%s Type of property') _('%s Types of property') 'property_48.png' _('Type of property') %}</th>
        <th class="actions"></th>
    {% end_get_block_header %}
    <tbody class="collapsable">
        <tr class="header toolbar">
            <th colspan="{{colspan}}" class="block_header_line_dark">
                {% get_line_adder at_url '/creme_config/property_type/add/' with_label _("New custom type of property") with_perms admin_perm %}
            </th>
        </tr>
        {% if page.paginator.count %}
            <tr class="header">
                {% get_column_header _('Text') 'text' %}
                <th class="block_header_line_light">{% trans "Applies on entities with following types" %}</th>
                <th class="block_header_line_light">{% trans "Is copiable" %}</th>
                <th class="block_header_line_light">{% trans "Statistics" %}</th>
                <th class="block_header_line_light action">{% trans "Edit" %}</th>
                <th class="block_header_line_light action">{% trans "Delete" %}</th>
            </tr>
            {% for prop_type in page.object_list %}{% cycle "block_line_dark" "block_line_light" as row_color silent %}
                <tr class="content">
                    {% comment %}<td class="{{row_color}}">{{prop_type.text}}</td>{% endcomment %}
                    <td class="{{row_color}}">{% widget_hyperlink prop_type %}</td>
                    <td class="{{row_color}}">
                        {% widget_select_or_msg prop_type.subject_ctypes.all _('No related type of resource') %}
                    </td>
                    <td class="{{row_color}}">
                        {% print_field object=prop_type field='is_copiable' %}
                    </td>
                    <td class="{{row_color}}">
                        {% blocktrans count prop_type.stats as count %}{{count}} entity with this property{% plural %}{{count}} entities with this property{% endblocktrans %}
                    </td>
                    <td class="{{row_color}} action">
                        {% if prop_type.is_custom %}{% get_line_editor at_url '/creme_config/property_type/edit/{{prop_type.id}}' with_perms admin_perm %}{% endif %}
                    </td>
                    <td class="{{row_color}} action">
                        {% if prop_type.is_custom %}{% get_line_deletor at_url '/creme_config/property_type/delete' with_args "{'id': '{{prop_type.pk}}'}" with_perms admin_perm %}{% endif %}
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <tr class="content empty">
                <td colspan="{{colspan}}" class="block_line_dark">{% trans "No type of property for the moment" %}</td>
            </tr>
        {% endif %}
    </tbody>
    {% get_block_footer colspan %}
</table>
{% endwith %}