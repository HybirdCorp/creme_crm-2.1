{% load i18n %}
{% load creme_block creme_core_tags %}
{% with has_perm=user.is_superuser current_user_id=user.id%}
<table class="table_detail_view ui-corner-all with-header {{state.classes}}" id="{{block_name}}">
    {% get_block_header colspan=11 %}
        <th class="label">{% get_block_title  _('%s User') _('%s Users') %}</th>
        <th class="actions"></th>
    {% end_get_block_header %}
    <tbody class="collapsable">
        <tr class="header toolbar">
            <th class="block_header_line_light" colspan="11">
                {% get_line_adder at_url '/creme_config/user/add/' with_label _("New user") with_perms has_perm %}
            </th>
        </tr>
        <tr class="header">
            {% get_column_header _("User name") 'username' %}
            {% get_column_header _('Last name') 'last_name' %}
            {% get_column_header _('First name') 'first_name' %}
            <th class="block_header_line_light">{% trans "Role" %}</th>
            {% get_column_header _('Email address') 'email' %}
            {% get_column_header _('Super-user ?') 'is_superuser' %}
            {% get_column_header _('Active ?') 'is_active' %}
            {% get_column_header _('Last login') 'last_login' %}
            {% get_column_header _("Date joined") 'date_joined' %}
            <th class="block_header_line_light action">{% trans "Actions" %}</th>
            <th class="block_header_line_light action">{% trans "Password" %}</th>
        </tr>
        {% for user in page.object_list %}{% cycle "block_line_light" "block_line_dark" as row_color silent %}
            <tr class="content">
                <td class="{{row_color}}">{{user.username}}</td>
                <td class="{{row_color}}">{{user.last_name}}</td>
                <td class="{{row_color}}">{{user.first_name}}</td>
                <td class="{{row_color}}">{{user.role|default:''}}</td>
                <td class="{{row_color}}">{{user.email}}</td>
                <td class="{{row_color}}">{{user.is_superuser|yesno:_('Yes,No')}}</td>
                <td class="{{row_color}}">
                    <input{% if user.is_active %} checked{% endif %} type="radio" {% if not has_perm or user.is_staff  or user.id == current_user_id %}disabled="true"{% else %} onmousedown="if (!this.checked){creme.blocks.ajaxPOSTQuery('/creme_config/user/activate/{{user.id}}', {blockReloadUrl: {% get_block_reload_uri %}}).start()}"{% endif %} name="user_{{user.id}}" value="false">{% trans "Yes" %}
                    <input{% if not user.is_active %} checked{% endif %} type="radio" {% if not has_perm or user.is_staff or user.id == current_user_id %}disabled="true"{% else %}onmousedown="if (!this.checked){creme.blocks.ajaxPOSTQuery('/creme_config/user/deactivate/{{user.id}}', {blockReloadUrl: {% get_block_reload_uri %}}).start()}"{% endif %} name="user_{{user.id}}" value="true">{% trans "No" %}
                </td>
                <td class="{{row_color}}">{{user.last_login}}</td>
                <td class="{{row_color}}">{{user.date_joined}}</td>
                <td class="{{row_color}} action">
                    {% get_line_editor at_url '/creme_config/user/edit/{{user.id}}' with_perms has_perm %}
                    {% if has_perm %}
                        <a onclick="creme.blocks.form('/creme_config/user/delete/{{user.id}}', {blockReloadUrl:{% get_block_reload_uri %}}).open();">
                            {% trans "Delete" as img_title %}<img src="{% creme_media_url 'images/delete_22.png' %}" border="0" title="{{img_title}}" alt="{{img_title}}" />
                        </a>
                    {% else %}
                        {% trans "Can't delete" as img_title %}<img class="forbidden" src="{% creme_media_url 'images/delete_22.png' %}" border="0" title="{{img_title}}" alt="{{img_title}}" />&nbsp;
                    {% endif %}
                </td>
                <td class="{{row_color}} action">
                    {% get_line_editor at_url '/creme_config/user/edit/password/{{user.id}}' with_perms has_perm %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
    {% get_block_footer 11 %}
</table>
{% endwith %}