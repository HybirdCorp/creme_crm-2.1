{% extends 'creme_core/bricks/base/base.html' %}
{% load i18n creme_bricks geolocation %}

{% block brick_extra_class %}geolocation-brick geolocation-google-neighbours-brick{% endblock %}

{% block brick_script %}
    <script type="text/javascript">
         $('.brick[id="{{brick_id}}"]').on('brick-ready', function(event, brick) {
             creme.geolocation.ready(
                 function() {
                     var controller = new creme.geolocation.PersonsNeighborhoodBlock(brick, {{radius}}, '{% url 'geolocation__neighbours' %}', '{% url 'geolocation__set_address_info' %}');

                     $('#{{maps_blockid}}').bind('brick-geoaddress-location', function(event, address, mark) {
                         controller.sourcePosition(address, mark.position);
                     });
                 },
                 '{{google_api_key}}'
             );
         });
    </script>
{% endblock %}

{% block brick_header_title %}
    {% brick_header_title title=_('Around this place') %}
{% endblock %}

{% block brick_content %}
    {% if not ref_addresses %}
    <div class="geolocation-empty-brick">{% trans 'No address defined for now' %}</div>
    {% else %}
{#    <div class="block-geoaddress-header"> #}
    <div class="geolocation-brick-header">
        <span class="block-geoaddress-counter">{% trans 'None of' %}</span>&nbsp;
        <select class="block-geoaddress-filter">
            <option value="">{% trans 'All the contacts and organisations' %}</option>
            {% for groupname, choices in address_filters %}
                <optgroup label="{{groupname}}">
                    {% for value, label in choices %}
                        <option value="{{value}}">{{label}}</option>
                    {% endfor %}
                </optgroup>
            {% endfor %}
        </select>
        &nbsp;{% trans 'around' %}&nbsp;
        <select class="block-geoaddress-source">
            {% for address in ref_addresses %}
                <option value="{{address.id}}">{% if address.title %}{{address.title}}{% else %}{{address.content}}{% endif %}</option>
            {% empty %}
                <option value="" disabled>{% trans 'No geolocated address for now' %}</option>
            {% endfor %}
        </select>&nbsp;
        {% blocktrans with radius_distance=radius|format_distance %}within a radius of {{radius_distance}}.{% endblocktrans %}
    </div>
    <div class="block-geoaddress-canvas"></div>{# TODO: rename the class when blocks have been removed #}
    {% endif %}
{% endblock %}
