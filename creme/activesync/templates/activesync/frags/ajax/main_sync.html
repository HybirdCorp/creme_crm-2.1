{% load i18n creme_block creme_core_tags activesync_tags %}

{% log 'The template file "creme/activesync/templates/activesync/frags/ajax/main_sync.html" is deprecated.' level='WARN' %}

<table class="table_header" cellpadding="0" cellspacing="0">
    <tr>
        <td width="5%">{% trans 'Phone synchronization' as img_title %}<img src="{% creme_media_url 'images/phone_sync_48.png' %}" alt="{{img_title}}" title="{{img_title}}"/></td>
        <td width="75%"><h1>{% trans 'Mobile synchronization' %}</h1></td>
        <td width="20%" align="right">
            <span>
{#                <a class="pointer" onclick="creme.blocks.form('/activesync/user_settings', {blockReloadUrl:{% get_block_reload_uri %}}).open();"> #}
                <a class="pointer" onclick="creme.blocks.form('{% url 'activesync__user_settings' %}', {blockReloadUrl:{% get_block_reload_uri %}}).open();">
                    {% trans "Edit your mobile configuration" as img_title %}<img src="{% creme_media_url 'images/config_64.png' %}" border="0" alt="{{img_title}}" title="{{img_title}}"/>
                </a>
                &nbsp;
{#                <a class="pointer" onclick="creme.ajax.reloadContent($('#sub_content'), '/activesync/sync');"> #}
                <a class="pointer" onclick="creme.ajax.reloadContent($('#sub_content'), '{% url 'activesync__sync' %}');">
                    {% trans "Refresh" as img_title %}<img src="{% creme_media_url 'images/refresh_64.png' %}" title="{{img_title}}" alt="{{img_title}}"/>
                </a>
            </span>
        </td>
    </tr>
</table>
{% if not fatal_error %}
    <div class="help_box with-table">
        <table>
            <thead>
                <tr>
                    <th class="th_info" colspan="2">{% trans "Your current parameters:" %}</th>
                </tr>
            </thead>
            <tbody>
                <tr class="content">
                    <th class="th_info">{% trans "Server URL" %}</th>
                    <td class="td_info">{{server_url}}</td>
                </tr>
                <tr class="content">
                    <th class="th_info">{% trans "Login" %}</th>
                    <td class="td_info">{{login}}</td>
                </tr>
                <tr class="content">
                    <th class="th_info">{% trans "Domain" %}</th>
                    <td class="td_info">{{domain}}</td>
                </tr>
                <tr class="content">
                    <th class="th_info">{% trans "Is secure (SSL)" %}</th>
                    <td class="td_info">{{server_ssl|print_boolean}}</td>
                </tr>
                <tr class="content">
                    <th class="th_info">{% trans "Last synchronization" %}</th>
                    <td class="td_info">{{last_sync|default:_("Never")}}</td>
                </tr>
                <tr class="separator">
                    <td class="td_info separator-line" colspan="2"></td>
                </tr>
                <tr class="content">
                    <th class="th_info">
                        <span class="icon">
                            {% trans "Calendar" as img_title %}<img src="{% creme_media_url 'images/calendar_22.png' %}" alt="{{img_title}}" title="{{img_title}}"/>
                        </span>
                        {% trans "Synchronize your calendars?" %}
                    </th>
                    <td class="td_info">{{sync_calendars|print_boolean}}</td>
                </tr>
                <tr class="content">
                    <th class="th_info">
                        <span class="icon">
                            {% trans "Contacts" as img_title %}<img src="{% creme_media_url 'images/contact_22.png' %}" alt="{{img_title}}" title="{{img_title}}"/>
                        </span>
                        {% trans "Synchronize your contacts?" %}
                    </th>
                    <td class="td_info">{{sync_contacts|print_boolean}}</td>
                </tr>
            </tbody>
        </table>
    </div>
{% endif %}
<table class="table_detail_view ui-corner-all" id="activesync-synchronization_result">
    <thead>
        <tr>
            <th class="th_info collapser" colspan="2">{% trans "Results of the synchronization" %}</th>
        </tr>
    </thead>
    <tbody class="collapsable">
        {% for type, messages in all_messages %}
            <tr class="header">
                <th class="th_info">{% with messages|length as messages_length%}{{messages_length}} {% get_verbose_message_type type messages_length %}{% endwith %}</th>
            </tr>
            {% for message in messages %}
                <tr class="content">
                    <td class="td_info">{% render_message message %}</td>
                </tr>
            {% endfor %}
        {% empty %}
            <tr class="content empty">
                <td class="td_info">{% trans "Nothing to synchronizeâ€¦" %}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

{% if ACTIVE_SYNC_DEBUG %}
<table class="table_detail_view ui-corner-all">
    <thead>
        <tr>
            <th class="th_info collapser" colspan="2">Debug info</th>
        </tr>
    </thead>
    <tbody class="collapsable">
        <tr class="content">
            <th class="block_header_line_light th_info">From XML</th>
            <td class="block_line_light td_info">
                <ul>{% for x in xml %}<li>{{x}}</li>{% endfor %}</ul>
            </td>
        </tr>
        <tr class="content">
            <th class="block_header_line_dark th_info">Info</th>
            <td class="block_line_dark td_info">
                <ul>{% for x in debug_info %}<li>{{x}}</li>{% endfor %}</ul>
            </td>
        </tr>
        <tr class="content">
            <th class="block_header_line_light th_info">Errors</th>
            <td class="block_line_light td_info">
                <ul>{% for x in debug_errors %}<li>{{x}}</li>{% endfor %}</ul>
            </td>
        </tr>
    </tbody>
</table>
{% endif %}

{% import_block from_app 'activesync' named 'user_synchronization_history' as 'user_synchronization_history_block' %}

{% display_block_detailview 'user_synchronization_history_block' %}

{% get_blocks_dependencies %}
