{% extends "creme_core/base.html" %}
{% load i18n creme_core_tags creme_block %}

{% block page_title %}{% trans 'Search results' %} - {% endblock %}

{% block extrahead %}
    <script>
        $(document).ready(function() {
            creme.utils.decorateSearchResult('{{research|escapejs}}');
        });
    </script>
{% endblock %}

{% block content %}
<div class="search_results">
    <table class="table_header" cellpadding="0" cellspacing="0">
        <tr>
            <td class="logo"><img src="{% creme_media_url 'images/search_64.png' %}" alt="{% trans "Search" %}"/></td>
            <td class="title">
                {% comment %}<h1>{% blocktrans count total as result_count %}Search results : {{result_count}} result{% plural %}Search results : {{result_count}} results{% endblocktrans %}</h1>{% endcomment %}
                <h1 id="search_results_title">Search results</h1>{% comment %}The title is updated by JavaScript{% endcomment %}
            </td>
            <td class="actions"></td>
        </tr>
    </table>
    {% if research or models %}
        <div class="help_box">
            <table>
                <tr>
                    <td><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span></td>
                    <td>
                        {% if research %}{% trans 'Your search : ' %}{{research}}<br/>{% endif %}
                        {% if models %}{% trans 'Concerned types : ' %}{{models|join:", "}}<br/>{% endif %}
                    </td>
                </tr>
            </table>
        </div>
    {% endif %}
    {% if error_message %}
        <ul class="errorlist">
            <li>{{error_message}}</li>
        </ul>
    {% endif %}
{% comment %}
    {% for result in results %}
        {% with result.entities as entities %}
            {% if entities %}
                {% with result.sfields as sfields %}
                    <div class="result">
                        <table class="table_detail_view ui-corner-all with-header">
                            <thead>
                                <tr>
                                    <th colspan="{{sfields|length|add:1}}" valign="middle" align="left">
                                        {{entities|length}}
                                        {% if entities|length == 1 %}{# todo: improve plural management...#}
                                            {{result.model|get_meta_value:"verbose_name"}}
                                        {% else %}
                                            {{result.model|get_meta_value:"verbose_name_plural"}}
                                        {% endif %}
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="collapsable">
                                <tr class="header">
                                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %} action">{% trans 'Action' %}</th>
                                    {% for sfield in sfields %}
                                        <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{{sfield}}</th>
                                    {% endfor %}
                                </tr>
                                {% for entity in entities %}
                                    <tr class="{% cycle "block_line_dark" "block_line_light" %} content">
                                        <td class="action"><a href="{{entity.get_absolute_url}}" {% if entity.is_deleted %}class="is_deleted"{% endif %}>{% trans 'Go to the page' %}</a></td>
                                        {% for sfield in sfields %}
                                            <td>{% print_field object=entity field=sfield.name %}</td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endwith %}
            {% endif %}
        {% endwith %}
    {% endfor %}
{% endcomment %}

    {% import_blocks blocks as 'result_blocks' %}
    {% display_blocks 'result_blocks' %}
    {% get_blocks_dependencies %}
</div>
{% endblock %}
