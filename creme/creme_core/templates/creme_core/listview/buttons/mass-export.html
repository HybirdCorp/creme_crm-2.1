{% load i18n creme_core_tags creme_widgets creme_ctype creme_query %}
{% if button.backend_choices %}{% has_perm_to export model as export_perm %}{% ctype_for_model model as ctype %}
    <a {% if export_perm %}class="with-icon" data-href="{% url 'creme_core__dl_listview' %}?ct_id={{ctype.id}}&list_url={{request.path}}&hfilter={{list_view_state.header_filter_id}}&extra_q={{button.extra_q.total|query_serialize|urlencode}}" onclick="event.preventDefault();creme.exports.exportAs($(this).attr('data-href'), {{button.backend_choices|jsonify}}, 'type');"{% else %}class="with-icon forbidden" title="{% trans 'Forbidden' %}"{% endif %}>
        {% trans 'Download' as label %}{% widget_icon name='document_csv' label=label size='listview-button' %}{{label}}
    </a>
{% endif %}
