{% load i18n %}
{% load creme_core_tags creme_block %}
{% load reports_tags %}
<table class="table_detail_view ui-corner-all {{state.classes}}" id="{{block_name}}">
    {% get_block_header colspan=2 %}
        <th class="label">
            {% with report_graph=graph|capfirst %}
                {% trans "Graph" context "reports-graphs" as img_title %}
                {% get_basic_block_header report_graph 'graph_48.png' img_title %}
            {% endwith %}
        <th class="actions"></th>
    {% end_get_block_header %}
    <tbody class="collapsable">
        <tr class="header toolbar">
            <th class="block_header_line_dark" align="left">
                <a class="button_link" href="{{graph.get_absolute_url}}">{% blocktrans %}Go to {{graph}}'s file{% endblocktrans %}</a>
            </th>
            <th class="block_header_line_dark" align="left">
                {% comment %}{% blocktrans with volatile_column|default:_("None") as vc %}Volatile column : {{vc}}{% endblocktrans %}{% endcomment %}
                {% blocktrans with vc=volatile_column %}Volatile column : {{vc}}{% endblocktrans %}
            </th>
        </tr>
        {% if x %}
            <tr class="content">
                <td class="{{row_color}} graph_global_container_{{instance_block_id}}" colspan="2">
                    <div class="ui-creme-widget ui-creme-chainedselect widget-auto" widget="ui-creme-chainedselect"
                         style="margin:0px;padding:0px;border:0px;">
                        <input type="hidden" name="" class="ui-creme-input ui-creme-chainedselect"></input>
                        <ul class="ui-layout hbox" style="padding:2px;">
                            {% report_chart_selector graph %}
                        </ul>
                        {% include 'reports/frags/graph_errors.html' with hand=graph.hand %}
                        <div chained-name="plot" class="ui-creme-chainedselect-item">
                            <div class="ui-widget-content ui-creme-widget ui-creme-plotselector" widget="ui-creme-plotselector"
                                 {% if object %}
                                 plot-data-url="/reports/graph/fetch_from_instance_block/{{instance_block_id}}/{{object.id}}/${sort}"
                                 {% else %}
                                 plot-data-url="/reports/graph/fetch_graph/{{graph.id}}/${sort}"
                                 {% endif %}
                                 plot-name="${graph}"
                                 style="width:100%;margin:0px;padding:0px;border:0px;">
                                 {% for name, chart in report_charts %}
                                    <script name="{{name}}" type="text/json">{% report_chart_json graph chart %}</script>
                                 {% endfor %}
                                <div class="ui-widget-content ui-creme-widget ui-creme-jqueryplot ui-creme-resizable" widget="ui-creme-jqueryplot" 
                                     savable="false" style="height:300px;padding:5px;border:0px;" format="creme.graphael.BargraphData">
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        {% elif error %}
            <tr class="content">
                <td class="td_error" colspan="2">{{error}}</td>
            </tr>
        {% else %}
            <tr class="content empty">
                <td colspan="2">
                    {% include 'reports/frags/graph_errors.html' with hand=graph.hand empty_message=_('No values or graph is not applicable here') %}
                </td>
            </tr>
        {% endif %}
    </tbody>
</table>
