{% extends 'creme_core/detailview.html' %}
{% load i18n creme_core_tags creme_widgets reports_tags %} {# creme_queryset #}

{% block page_title %}{% blocktrans %}Preview {{object}}{% endblocktrans %} - {% endblock %}

{% block extrahead %}
    {{block.super}}
    <script type='text/javascript'>
        $(document).ready(function() {
            var controller = new creme.reports.PreviewController('{% url 'reports__export_report_preview' object.id %}', '{% url 'reports__export_report' object.id %}');
            controller.bind($('.report-preview'));
        });
    </script>
{% endblock %}

{% block before_content_1 %}
    <div class="buttons-list global-buttons">
        <ul>
            <li>
                <a class="menu_button menu-button-icon" href="{{object.get_absolute_url}}">{% trans 'Back to the report' as back_label %}
                    {% widget_icon name='previous' size='global-button' label=back_label %}
                    {{back_label}}
                </a>
            </li>
        </ul>
    </div>
{% endblock %}

{% block content %}
<div class="hat-bar-container">
    <div class="hat-bar">
        <div class="bar-icon">{% widget_icon instance=object size='brick-hat-bar' %}</div>
        <div class="bar-title">
            <h1>{% blocktrans with title=object|capfirst %}Preview of the report «{{title}}»{% endblocktrans %}</h1>
        </div>
    </div>
</div>

<div class="report-preview">
    <div class='scrollable-block-container report-preview-header'>
        <form>
        {% include 'reports/frags/report_preview_format.html' %}
        </form>
        <button type="button" name="generate">{% trans 'Preview' %}</button>
        <button type="button" name="download">{% trans 'Download as file' %}</button>
    </div>

    {% include 'reports/bricks/preview.html' %}

{% comment %}
    <div class='scrollable-block-container report-preview-data'>
        <table class="table_detail_view ui-corner-all with-header" >
            <thead>
                <tr>
                    <th colspan="{{flat_columns|length}}">
                        {% if empty_message %}
                            {% trans 'Preview' %}
                        {% elif lines|length < limit_to %}
                            {% blocktrans count lines_count=lines|length %}Preview of {{lines_count}} line{% plural %}Preview of {{lines_count}} lines{% endblocktrans %}
                        {% else %}
                            {% blocktrans %}Preview of the {{limit_to}} first lines{% endblocktrans %}
                        {% endif %}
                    </th>
                </tr>
            </thead>
            <tbody class="collapsable">
                {% if not empty_message %}
                    <tr class="header">
                        {% for column in flat_columns %}{% cycle "block_header_line_dark" "block_header_line_light" as header_color silent %}
                            <th class="{{header_color}}">{{column}}</th>
                        {% endfor %}
                    </tr>
                    {% for line in lines %}{% cycle "block_line_dark" "block_line_light" as row_color silent %}
                        <tr class="content">
                            {% for val in line %}
                                <td class="{{row_color}}">{{val}}&nbsp;</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr class="content empty">
                        <td class="block_line_dark">{{empty_message}}</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
{% endcomment %}
</div>
{% endblock %}
