{% load i18n %}
{% load creme_block creme_core_tags creme_widgets %}

{% log '"creme/crudity/templates/crudity/templatetags/block_history.html" is deprecated.' level='WARN' %}

<style type="text/css">
    {% comment %}Generify this{% endcomment %}
    .type_header_block {
        {% comment %}background: url({% get_image_path_for_ctype email_ct 'normal' %}) no-repeat;{% endcomment %}
        background: url({% creme_media_url 'images/email_48.png' %}) no-repeat;
        width: 48px;
        height:48px;
    }
</style>
{% with 6 as colspan %}
    <table class="table_detail_view ui-corner-all with-header {{state.classes}}" id="{{block_name}}">
        {% get_block_header colspan=colspan %}
            <th class="label">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr>
                            <th class="type_header_block">{% get_image_for_ctype ct 'small' %}
                                </th>
                            <th>{% blocktrans count page.paginator.count as counter with ct_name=ct %}{{counter}} History item - {{ct_name}}{% plural %}{{counter}} History items - {{ct_name}}{% endblocktrans %}</th>
                        </tr>
                    </tbody>
                </table>
            </th>
            <th class="actions">
                <div class="buttons"></div>
            </th>
        {% end_get_block_header %}
        <tbody class="collapsable">
            {% if page.paginator.count %}
                <tr class="header">
                    <th class="block_header_line_dark">{% trans "Entity" %}</th>
                    <th class="block_header_line_dark">{% trans "Created" %}</th>
                    <th class="block_header_line_dark">{% trans "Action" %}</th>
                    <th class="block_header_line_dark">{% trans "Source" %}</th>
                    <th class="block_header_line_dark">{% trans "Description" %}</th>
                    <th class="block_header_line_dark action">{% trans "View entity's file" %}</th>
                </tr>
                {% for history in page.object_list %}{% cycle "block_line_dark" "block_line_light" as row_color silent %}
                    <tr class="content">
                        {% with history.get_entity as history_entity %}
                            <td class="{{row_color}}">{{history_entity|allowed_unicode:user}}</td>
                            <td class="{{row_color}}">{{history.created}}</td>
                            <td class="{{row_color}}">{{history.action}}</td>
                            <td class="{{row_color}}">{{history.source}}</td>
                            <td class="{{row_color}}">{{history.description}}</td>
                            <td class="{{row_color}} action"><a href="{{history_entity.get_absolute_url}}"><img src="{% creme_media_url 'images/view_22.png' %}" border="0" title="{% blocktrans %}View '{{history_entity}}' details{% endblocktrans %}" alt="{% trans "View" %}" /></a></td>
                        {% endwith %}
                    </tr>
                {% endfor %}
            {% else %}
                <tr class="content empty">
                    <td class="block_line_dark">{% blocktrans with ct as ct_name %}No waiting action for {{ct_name}}{% endblocktrans %}</td>
                </tr>
            {% endif %}
        </tbody>
        {% get_block_footer colspan %}
    </table>
{% endwith %}
